<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Parking - Login & Signup</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Inter', sans-serif; background:#1a1f71; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px; }
.container { width:100%; max-width:1000px; display:flex; background:white; border-radius:20px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,0.3); min-height:600px; }
.left-section { flex:1; background:linear-gradient(135deg,#1a1f71 0%,#2d3561 100%); color:white; padding:60px 40px; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
.logo-box { width:100px; height:100px; background:rgba(255,255,255,0.15); backdrop-filter:blur(10px); border:3px solid rgba(255,255,255,0.3); border-radius:20px; display:flex; align-items:center; justify-content:center; font-size:50px; font-weight:700; margin-bottom:30px; }
.left-section h1 { font-size:32px; font-weight:700; margin-bottom:15px; }
.left-section p { font-size:18px; opacity:0.9; line-height:1.6; }
.feature-list { margin-top:40px; text-align:left; }
.feature-item { display:flex; align-items:center; margin-bottom:20px; opacity:0.9; }
.feature-item::before { content:"‚úì"; display:inline-block; width:24px; height:24px; background:rgba(255,255,255,0.2); border-radius:50%; text-align:center; line-height:24px; margin-right:12px; font-weight:700; }
.right-section { flex:1; padding:60px 50px; display:flex; flex-direction:column; justify-content:center; }
.tab-buttons { display:flex; gap:15px; margin-bottom:30px; }
.tab-btn { flex:1; padding:12px; border:2px solid #e0e0e0; background:white; color:#666; border-radius:10px; cursor:pointer; font-size:16px; font-weight:600; transition:all 0.3s; }
.tab-btn.active { background:#1a1f71; color:white; border-color:#1a1f71; }
.form-container { position:relative; }
.form { display:none; animation:fadeIn 0.4s ease; }
.form.active { display:block; }
@keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
.role-selection { margin-bottom:25px; }
.role-selection label { display:block; font-size:14px; font-weight:600; color:#333; margin-bottom:10px; }
.role-options { display:grid; grid-template-columns:1fr 1fr; gap:15px; }
.role-option { position:relative; }
.role-option input[type="radio"] { display:none; }
.role-card { padding:20px; border:2px solid #e0e0e0; border-radius:12px; cursor:pointer; transition:all 0.3s; text-align:center; }
.role-option input[type="radio"]:checked + .role-card { border-color:#1a1f71; background:#f0f1ff; }
.role-icon { font-size:32px; margin-bottom:8px; }
.role-title { font-weight:600; color:#333; font-size:15px; }
.input-group { margin-bottom:20px; }
.input-group label { display:block; font-size:14px; font-weight:600; color:#333; margin-bottom:8px; }
.input-group input { width:100%; padding:14px 16px; border:2px solid #e0e0e0; border-radius:10px; font-size:15px; transition:all 0.3s; outline:none; }
.input-group input:focus { border-color:#1a1f71; box-shadow:0 0 0 3px rgba(26,31,113,0.1); }
.checkbox-group { display:flex; align-items:center; gap:8px; margin-bottom:20px; }
.checkbox-group input[type="checkbox"] { width:18px; height:18px; cursor:pointer; }
.checkbox-group label { font-size:14px; color:#666; cursor:pointer; }
.btn { width:100%; padding:16px; background:#1a1f71; color:white; border:none; border-radius:10px; font-size:16px; font-weight:600; cursor:pointer; transition:all 0.3s; position:relative; }
.btn:hover:not(:disabled) { background:#151a5a; transform:translateY(-2px); box-shadow:0 5px 15px rgba(26,31,113,0.3); }
.btn:disabled { background:#ccc; cursor:not-allowed; transform:none; }
.forgot-link { display:block; text-align:center; margin-top:15px; color:#1a1f71; text-decoration:none; font-size:14px; font-weight:500; }
.forgot-link:hover { text-decoration:underline; }
.message { position:fixed; top:20px; right:20px; padding:16px 24px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.2); display:none; animation:slideIn 0.3s ease; z-index:1000; }
.message.success { background:#27ae60; color:white; }
.message.error { background:#e74c3c; color:white; }
.message.show { display:block; }
@keyframes slideIn { from { transform:translateX(400px); opacity:0; } to { transform:translateX(0); opacity:1; } }
@media (max-width:768px) { .container { flex-direction:column; } .left-section { padding:40px 30px; } .right-section { padding:40px 30px; } .feature-list { display:none; } }
</style>
</head>
<body>
<div class="container">
  <div class="left-section">
    <div class="logo-box">P</div>
    <h1>SMART PARKING</h1>
    <p>Book your parking space in advance and save time</p>
    <div class="feature-list">
      <div class="feature-item">Real-time availability</div>
      <div class="feature-item">Secure online payments</div>
      <div class="feature-item">Instant booking confirmation</div>
      <div class="feature-item">24/7 customer support</div>
    </div>
  </div>

  <div class="right-section">
    <div class="tab-buttons">
      <button class="tab-btn active" onclick="switchTab('login')">Login</button>
      <button class="tab-btn" onclick="switchTab('signup')">Sign Up</button>
    </div>

    <div class="form-container">
      <!-- LOGIN FORM -->
      <form id="loginForm" class="form active" onsubmit="handleLogin(event)">
        <div class="role-selection">
          <label>Login as:</label>
          <div class="role-options">
            <div class="role-option">
              <input type="radio" id="loginUser" name="loginRole" value="driver" checked>
              <label for="loginUser" class="role-card"><div class="role-icon">üë§</div><div class="role-title">User</div></label>
            </div>
            <div class="role-option">
              <input type="radio" id="loginAdmin" name="loginRole" value="operator">
              <label for="loginAdmin" class="role-card"><div class="role-icon">üè¢</div><div class="role-title">Admin</div></label>
            </div>
          </div>
        </div>

        <div class="input-group">
          <label>Email Address</label>
          <input type="email" id="loginEmail" placeholder="Enter your email" required>
        </div>

        <div class="input-group">
          <label>Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" required>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="rememberMe">
          <label for="rememberMe">Remember me</label>
        </div>

        <button type="submit" class="btn" id="loginBtn">Login</button>
      </form>

      <!-- SIGNUP FORM -->
      <form id="signupForm" class="form" onsubmit="handleSignup(event)">
        <div class="role-selection">
          <label>Register as:</label>
          <div class="role-options">
            <div class="role-option">
              <input type="radio" id="signupUser" name="signupRole" value="driver" checked>
              <label for="signupUser" class="role-card"><div class="role-icon">üë§</div><div class="role-title">User</div></label>
            </div>
            <div class="role-option">
              <input type="radio" id="signupAdmin" name="signupRole" value="operator">
              <label for="signupAdmin" class="role-card"><div class="role-icon">üè¢</div><div class="role-title">Parking Owner</div></label>
            </div>
          </div>
        </div>

        <div class="input-group">
          <label>Full Name</label>
          <input type="text" id="signupName" placeholder="Enter your full name" required>
        </div>

        <div class="input-group">
          <label>Email Address</label>
          <input type="email" id="signupEmail" placeholder="Enter your email" required>
        </div>

        <div class="input-group">
          <label>Password</label>
          <input type="password" id="signupPassword" placeholder="Create a strong password" required>
        </div>

        <div class="input-group">
          <label>Confirm Password</label>
          <input type="password" id="signupConfirmPassword" placeholder="Confirm your password" required>
        </div>

        <div class="input-group">
          <label>Phone Number</label>
          <input type="tel" id="signupPhone" placeholder="+250780000000" required>
        </div>

        <div class="input-group driver-only" id="vehiclePlateGroup" style="display: none;">
          <label>Vehicle Plate Number</label>
          <input type="text" id="signupPlate" placeholder="RAD 123A">
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="agreeTerms" required>
          <label for="agreeTerms">I agree to the Terms & Conditions</label>
        </div>

        <button type="submit" class="btn" id="signupBtn">Create Account</button>
      </form>
    </div>
  </div>
</div>

<script src="./assets/js/config.js"></script>
<script>
// Switch tabs
function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.form').forEach(f => f.classList.remove('active'));
  if(tab === 'login') {
    document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
    document.getElementById('loginForm').classList.add('active');
  } else {
    document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
    document.getElementById('signupForm').classList.add('active');
  }
}

// Handle login
async function handleLogin(e) {
  e.preventDefault();

  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const role = document.querySelector('input[name="loginRole"]:checked').value;
  
  const btn = document.getElementById('loginBtn');
  btn.disabled = true;
  btn.textContent = 'logging in...';

  try {
    // determine the correct endpoint
    const endpoint = role === "driver" ? "/auth/driver/login" : "/auth/operator/login";

    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email, password })
    });

    const data = await response.json();

    if (response.ok && data.success) {

        const user = role === "driver" ? data.driver : data.operator;

        sessionStorage.setItem('userData', JSON.stringify(user));
        
        if(role === "driver") {
          const driverId = user.id || user.driver_id;
          localStorage.setItem('driver_id', driverId);
          console.log("stored driver_id:", localStorage.getItem('driver_id'));
        }

        // redirect based on role
        if(role === 'admin') {
            window.location.href = './pages/Admin_dashboard2.html';
        } else {
            window.location.href = './pages/User_dashboard.html';
        }
    
    } else {
        alert(data.message || 'Login failed');
    }

  } catch (error) {
    console.error('Login error:', error);
    alert('Network error. Please check your connection.');
  } finally {
    btn.disabled = false;
    btn.textContent = 'Login';
  }
}

document.getElementById('loginForm').addEventListener('submit', handleLogin);

// Handle signup (redirect similar to login)
async function handleSignup(e) {
  e.preventDefault();

  // Form values
  const name = document.getElementById('signupName').value;
  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;
  const phone = document.getElementById('signupPhone').value;
  const role = document.querySelector('input[name="signupRole"]:checked').value;
  
  let vehiclePlate = "";
  if (role === "driver") {
    vehiclePlate = document.getElementById('signupPlate').value;
  }

  const payload = role === "driver"
    ? {
        username: name,
        email,
        password,
        phone_number: phone,
        vehicle_plate: vehiclePlate
      }
    : {
        operator_name: name,
        email,
        password,
        phone_number: phone
      };

  const btn = document.getElementById('signupBtn');
  btn.disabled = true;
  btn.textContent = 'Signing up...';

  try{
    // Determine endpoint
    const endpoint = role === "driver" ? "/auth/driver/signup" : "/auth/operator/signup";

    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    const data = await response.json();

    if (data.success) {
      alert("Signup successful!");
    
      if (role === "driver") {
        localStorage.setItem("driver_id", data.driver.driver_id);
        window.location.href = "./pages/User_dashboard.html";
      } else {
        window.location.href = "./pages/Admin_dashboard2.html";
      }
    } else{
      alert(data.message || "Signup failed");
    }

  } catch (err) {
      console.error(err);
      alert('Network error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'Sign Up';
  }
}
document.getElementById('loginForm').addEventListener('submit', handleLogin);
document.getElementById('signupForm').addEventListener('submit', handleSignup);
document.querySelectorAll('input[name="signupRole"]').forEach(r => {
  r.addEventListener('change', function () {
    document.getElementById("vehiclePlateGroup").style.display =
      this.value === "driver" ? "block" : "none";
  });
});
const checkedRole = document.querySelector('input[name="signupRole"]: checked');
if (checkedRole) checkedRole.dispatchEvent(new Event('change'));
</script>
</body>
</html>
